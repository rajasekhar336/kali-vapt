# Phase 2: Network Scanning - Complete Implementation

## ðŸŽ¯ **Network Scanning Rules Applied**

### **ðŸ“Š Tool Processing Rules**

| Tool | Output Size | Action | Processing |
|------|------------|--------|------------|
| **naabu** | Many open ports | ðŸ” Feed â†’ nmap | âŒ Skip (input) |
| **rustscan** | Many open ports | ðŸ” Feed â†’ nmap | âŒ Skip (input) |
| **nmap** | Any | âœ… Import | Direct to DetectDojo |
| **masscan** | Any | âœ… Import | Direct to DetectDojo |
| **httpx** | Many hosts | âœ… Import | Direct to DetectDojo |

---

## **ðŸ”„ Network Pipeline Implementation**

### **ðŸš« Port Scanner Inputs (2 tools) - Skip + Pipeline Feed**
```bash
# naabu (50+ ports) â†’ Feed to nmap for detailed scanning
naabu.txt â†’ extract hosts â†’ nmap detailed scans â†’ naabu_nmap_*.xml â†’ DetectDojo

# rustscan (50+ ports) â†’ Feed to nmap for detailed scanning  
rustscan.xml â†’ extract hosts â†’ nmap detailed scans â†’ rustscan_nmap_*.xml â†’ DetectDojo
```

### **âœ… Network Risk Tools (3 tools) - Direct Import to DetectDojo**
```bash
# nmap_* (any) â†’ Direct to DetectDojo (network risk)
nmap_comprehensive_*.xml â†’ Rule-Based â†’ DetectDojo

# masscan_* (any) â†’ Direct to DetectDojo (network risk)
masscan_*.txt â†’ Rule-Based â†’ DetectDojo

# httpx (many hosts) â†’ Direct to DetectDojo (network risk)
httpx.txt â†’ Rule-Based â†’ DetectDojo
```

---

## **ðŸ“ˆ Processing Flow**

```bash
# Phase 2: Network Scanning
naabu â†’ port_list.txt âŒ (skip if >50 ports)
rustscan â†’ port_scan.xml âŒ (skip if >50 ports)
    â†“ Pipeline feeding (if large outputs)
naabu.txt â†’ nmap detailed scans â†’ naabu_nmap_*.xml âœ…
rustscan.xml â†’ nmap detailed scans â†’ rustscan_nmap_*.xml âœ…

# Direct network risk imports
nmap_comprehensive_*.xml â†’ Direct to DetectDojo âœ…
masscan_*.txt â†’ Direct to DetectDojo âœ…
httpx.txt â†’ Direct to DetectDojo âœ…
```

---

## **ðŸ”§ Pipeline Feeding Logic**

### **Naabu Pipeline:**
```bash
# Check if naabu has >50 open ports
if [[ $(wc -l < naabu.txt) -gt 50 ]]; then
    # Extract unique hosts
    cat naabu.txt | cut -d: -f1 | sort -u > naabu_hosts.txt
    
    # Feed each host to nmap for detailed scanning
    while read -r host; do
        nmap -sV -sC -oA naabu_nmap_${host//./_} \
            -p $(ports_for_host) $host
    done < naabu_hosts.txt
    
    # Queue results for processing
    queue_tool_processing "naabu_nmap_$host" "naabu_nmap_*.xml"
fi
```

### **Rustscan Pipeline:**
```bash
# Check if rustscan has >50 open ports
if [[ $(xq '.nmaprun.host.ports.port | length' rustscan.xml) -gt 50 ]]; then
    # Extract hosts from XML
    xq -r '.nmaprun.host.address."@addr"' rustscan.xml > rustscan_hosts.txt
    
    # Feed each host to nmap for detailed scanning
    while read -r host; do
        nmap -sV -sC -oA rustscan_nmap_${host//./_} $host
    done < rustscan_hosts.txt
    
    # Queue results for processing
    queue_tool_processing "rustscan_nmap_$host" "rustscan_nmap_*.xml"
fi
```

---

## **âœ… Benefits of Network Strategy**

### **ðŸŽ¯ Smart Resource Management**
- **Skip basic port lists** (naabu/rustscan) - treated as inputs
- **Focus on detailed scans** (nmap/masscan) - represent real network risk
- **Pipeline feeding** enhances coverage without redundant processing

### **ðŸ”„ Enhanced Coverage**
- **Large port discoveries** automatically trigger detailed nmap scans
- **Comprehensive service detection** for high-port-count targets
- **Optimized scanning** based on output size

### **ðŸ“Š Clean Risk Assessment**
- **Only network risk data** sent to DetectDojo
- **No noise** from basic port discovery
- **Meaningful findings** for correlation

---

## **ðŸ“‹ Final Network Tool Classification**

### **ðŸš« Skip Processing (2 tools)**
```
naabu, rustscan (fed to nmap pipeline if large outputs)
```

### **âœ… Direct Import (3 tools)**
```
nmap_*, masscan_*, httpx (network risk - direct to DetectDojo)
```

### **ðŸ”„ Pipeline Outputs (Dynamic)**
```
naabu_nmap_*, rustscan_nmap_* (generated by pipeline, direct to DetectDojo)
```

---

## **ðŸš€ Example Execution**

```bash
./run_enhanced.sh example.com

# Network Phase Results:
naabu â†’ 200 open ports â†’ ðŸ” Feed to nmap â†’ 5 detailed nmap scans
rustscan â†’ 150 open ports â†’ ðŸ” Feed to nmap â†’ 3 detailed nmap scans
nmap â†’ 10 IPs scanned â†’ âœ… Direct to DetectDojo
masscan â†’ Port sweep â†’ âœ… Direct to DetectDojo  
httpx â†’ 50 live hosts â†’ âœ… Direct to DetectDojo

# Final Processing:
8 nmap scans + 1 masscan + 1 httpx â†’ DetectDojo (network risk data)
```

**ðŸŽ¯ Your network scanning now intelligently distinguishes between port discovery inputs and actual network risk findings!**
